S3からファイル取得〜アップ完了~DB更新完了までの流れ


〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜
【チケット：AWSアップ】

========================================
S3ファイル取得
========================================
S3各階層 >> srcフォルダに一括格納


========================================
リネーム
========================================
----------------------------------------
リネーム前準備
----------------------------------------
　└　EXCELで新ファイル名のリスト作成

　└　srcフォルダ>> S3階層と同じ階層にファイルを配置( ローカル上 )
　　　　※異階層/同名ファイルが存在するのでリネーム前に別離する必要がある
　　　　　　(例：~/registered/A.pdf　↔︎　~/franchise/A.pdf


----------------------------------------
リネーム
----------------------------------------
　└　cpコマンドで一括リネーム
　　　　コマンド：cp 現行パス/現行ファイル名 新パス/新ファイル名


========================================
S3アップロード
========================================
　└　フォルダ単位くらいでまとめてアップしていく
　　　　①S3手動アップ
　　　　　　>> ②オブジェクトURLをEXCELに貼り付け
　　　　　　　　　>> ③該当行のステータスを「済」に変更



〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜
【チケット：アップデート】

========================================
UPDATE & 切り戻しクエリ作成
========================================
----------------------------------------
前準備
----------------------------------------
　└　現行URLを条件とするので、それで全てアップデートされるか精査
　　　　※ 現行URL単位でしか見ていないので、登録区分など踏まえて改めて更新が想定通りか確認しておいたほうがいいと思う（心配）
　　　　※ 随時情報ファイル更新により、一覧作成時点と状態が変わっている項目があるので今回対応でデグレしないように確認が必要

----------------------------------------
作成
----------------------------------------
　└　EXCELに関数を入れる ( SET句、WHERE句 )　※update・切り戻し両方対応

----------------------------------------
条件とリスク回避
----------------------------------------
　条件　----------------------------------------
　　　　・アップロードURL（= 実ファイルの参照単位での変更を行う）
　　　　　　※更新レコード数(約320件)
　　　　　　※アップロードURL数(約170ファイル)
　
　実行時のリスク　----------------------------------------
　　　　・旧ファイルと新ファイルの内容が一致しない
　　　　　　└ クエリの紐付けミス[ EXCEL要因 でset句の値を間違える]
　　　　　　└ リネーム対象のファイル間違い[ register配下とfranchise配下の同名ファイルが入れ替わっている.... ]
　　　　・デグレ
　　　　　　└ 本件作業着手後にDBを更新したURLまで一緒に更新されてしまい、最新でないファイルを参照してしまう


========================================
UPDATE対応
========================================
----------------------------------------
前準備
----------------------------------------
　└　更新単位( where句 )でクエリをまとめておく？

----------------------------------------
実行
----------------------------------------
　└　実行

----------------------------------------
検証
----------------------------------------
　└　URLが生きていることの確認（更新後のURLを chrome で検索して表示される）
　└　画面確認？この場合は、「ログイン>>画面表示確認」となる。DB上で登録されている画面ルート320件分見る必要がある

----------------------------------------
切り戻し対応
----------------------------------------
　└　判断基準に沿って、URL単位で切り戻す
　└　イレギュラー：URLに対し5件紐づいている場合で、うち1件だけ何かおかしい（そもそも別URLで登録されるべきだった）>> プラスid指定で個別切り戻し

　切り戻し判断基準　----------------------------------------
　　　　・更新したURLが chromeで表示されない ( URL不備 )
　　　　・画面( 登録区分でログイン )から正しいURLが表示されない( 登録店でログインしたのに、価格表が加盟店のファイルになっている ) 
　

〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜
【完】
